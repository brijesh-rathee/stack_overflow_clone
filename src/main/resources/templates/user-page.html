<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{home-page}">
<head>
  <meta charset="UTF-8">
  <title>Users Page</title>
  <style>
    .user-container {
      padding: 0 20px;
    }

    .top-section h1 {
      font-size: 2.5rem;
      font-weight: 400;
      margin-bottom: 20px;
    }

    .bottom-section {
      display: flex;
      flex-direction: column;
    }

    .bottom-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
    }

    .search-box input {
      width: 30%;
      padding: 8px 12px;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .filters {
      margin-left: 20px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .filters span {
      background-color: #f2f2f2;
      padding: 6px 10px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      color: #333;
    }

    .user-list {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      width: 100%;
      box-sizing: border-box;
    }

    .user-card {
      background-color: #F5F5F5;
      border: 1px solid #D9D9D9;
      padding: 16px;
      border-radius: 8px;
      box-sizing: border-box;
      height: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100%;
      min-width: 0;
      word-break: break-word;
      text-align: center;
    }


    .avatar {
      width: 60px;
      height: 60px;
      background-color: #F58021;
      color: white;
      font-weight: bold;
      font-size: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
    }

    .user-info {
      text-align: center;
    }

    .user-info strong {
      font-size: 16px;
    }

    .user-info .location {
      font-size: 13px;
      color: #555;
    }

    .reputation {
      font-size: 14px;
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
    }

    .tags {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 10px;
    }

    .tags span {
      background-color: #d0e3f1;
      color: #39739d;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
    }
  </style>
</head>
<body>

<div class="user-container sec-container" layout:fragment="content">
  <div class="top-section">
    <h1>Users</h1>
  </div>

  <div class="bottom-section">

    <div class="bottom-header">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search users..." />
      </div>
      <div class="filters">
        <span class="filter-tag" data-filter="reputations">Reputations</span>
        <span class="filter-tag" data-filter="new">New Users</span>
        <span class="filter-tag" data-filter="voters">Voters</span>
        <span class="filter-tag" data-filter="editors">Editors</span>
        <span class="filter-tag" data-filter="moderators">Moderators</span>
      </div>
    </div>

    <div class="user-list">
      <div class="user-card" th:each="user : ${allUsers}"
           th:attr="data-username=${user.username},
                    data-location=${user.location},
                    data-reputation=${user.reputation},
                    data-role='user'">
        <div class="avatar" th:text="${user.username.substring(0,1).toUpperCase()}">A</div>
        <div class="user-info">
          <strong th:text="${user.username}">Username</strong>
          <div class="location" th:if="${user.location}" th:text="${user.location}">Location</div>
        </div>
        <div class="reputation" th:text="'Reputation: ' + ${user.reputation}">Reputation: 123</div>
        <div class="tags">
          <span>git</span>
          <span>java</span>
          <span>docker</span>
        </div>
      </div>
    </div>

  </div>
</div>

<script>
  const searchInput = document.getElementById('searchInput');
  const filterTags = document.querySelectorAll('.filter-tag');
  const userCards = document.querySelectorAll('.user-card');

  let debounceTimer = null;
  let currentFilter = "";

  searchInput.addEventListener('input', () => {
    clearTimeout(debounceTimer);
    debounceTimer = setTimeout(() => {
      const query = searchInput.value.trim().toLowerCase();
      filterUsers(query, currentFilter);
    }, 2000);
  });

  filterTags.forEach(tag => {
    tag.addEventListener('click', () => {
      currentFilter = tag.dataset.filter;
      const query = searchInput.value.trim().toLowerCase();
      filterUsers(query, currentFilter);
    });
  });

  function filterUsers(query, filter) {
    userCards.forEach(card => {
      const username = card.dataset.username.toLowerCase();
      const location = (card.dataset.location || "").toLowerCase();
      const reputation = parseInt(card.dataset.reputation);
      const role = (card.dataset.role || "").toLowerCase();

      let matchesSearch = username.includes(query) || location.includes(query);

      let matchesFilter = true;
      switch (filter) {
        case 'reputations':
          matchesFilter = reputation > 1000;
          break;
        case 'new':
          matchesFilter = reputation < 100;
          break;
        case 'voters':
        case 'editors':
        case 'moderators':
          matchesFilter = role === filter;
          break;
      }

      card.style.display = (matchesSearch && matchesFilter) ? "block" : "none";
    });
  }
</script>

</body>
</html>
